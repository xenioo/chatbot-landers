<html>
<head>
    <meta charset="UTF-8">
    <title>Ask me anything | by Xenioo</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta name="description" content="Ask me anythin and I will do my best to give you the best answer.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Alegreya" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@5.10.1/dist/typeit.min.js"></script>
</head>
<body>
    <div class="xn-content">
        <div class="xn-container desktop">
            <div style="display: none;" class="xn-chat-view">
                <div class="xn-chat-wrapper">
                    <div class="xn-loaders-container">
                        <div id="xn-loader" class="xn-loader"></div>
                    </div>
                    <div class="xn-chat-container">
                        <div id="xn-chat-reply" class="xn-question-text xn-chat-text"></div>
                        <div class="xn-chat-elements-container"></div>                        
                    </div>
                    <div class="xn-chat-input-wrapper">
                        <div class="xn-chat-input-container">
                            <input id="user_text" class="xn-chat-input" type="text" onkeyup="if (event.keyCode == 13) { Say(); }" />
                        </div>                   
                        <div class="xn-chat-input-footer">
                            <a href="https://www.xenioo.com"><div class="xn-chat-logo"></div></a>
                            <div>
                                <a class="xn-chat-signup-button" href="https://app.xenioo.com/auth/signup">SIGN UP HERE!</a>
                                <button id="send_button" class="xn-chat-submit-button" onclick="Say();"><span>SUBMIT</span></button>
                            </div> 
                        </div>         
                    </div>
                </div>
            </div>
            <div class="xn-intro-view">
                <div class="xn-intro-loaders-wrapper">
                    <div class="xn-loaders-container">
                        <div id="xn-loader" class="xn-loader xn-loader-reveal"></div>
                    </div>
                </div>
                <div class="xn-intro-copy-wrapper">
                    <div id="xn-intro-text" class="xn-question-text xn-intro-text"></div>
                    <hr class="xn-intro-hr">                    
                    <span class="xn-intro-subtext">Build chatbots for Web, Slack, Facebook and Telegram with Xenioo:&nbsp;<strong>Build Once, Publish Anywhere!</strong></span>
                </div>
                <div class="xn-intro-logo-wrapper">
                    <div class="xn-intro-logo"></div>
                </div>
                <button id="xn-intro-view-cta" class="xn-action-button" onclick="start();"><span>Get Started</span></button>
            </div>
        </div>
    </div>
    <script src="https://app.xenioo.com/webchatsrc/xeniooweb.js"></script>
    <script>
        var loader = 'reveal';
        var queue = [];
        var botid = 'df16e5cd-7766-42ea-b071-286ca8844c84';

        function putInQueue(fn) {
            queue.push(fn);
        }

        function doNextQueue() {
            if (queue.length == 0) {
                setChatLoader('idle');
                return;
            }
            
            setChatLoader('think');

            var fn = queue.shift();

            fn();
        }

        var typeitInstanceIntro = new TypeIt('#xn-intro-text', {
            speed: 25,
            autoStart: false,
            cursor: false,
            breakLines: false,
            startDelete: true,
            afterString: function(instance) {
                setIntroLoader('idle');
            }
        });
        
        var createTypeitChatInstance = function() { return new TypeIt('#xn-chat-reply', {
                speed: 25,
                autoStart: false,
                cursor: false,
                startDelete: false,
                beforeString: function(step, queue, instance) {
                    setChatLoader('speak');
                },
                afterString: function(step, queue, instance) {
                    doNextQueue();
                }
            });
        };

        var typeitInstanceChat = createTypeitChatInstance();

        $(document).ready(function () {
            setTimeout(function () {
                speakIntro('Hi! How can I help you today?');
            }, 5800);
        });

        function start() {
            $('.xn-intro-view').css('display', 'none');
            $('.xn-chat-view').css('display', 'block');

            loader = '';
            setChatLoader('think');

            Xenioo(botid, {
                replyFn: reply,
                createbutton:false,
                createarea: false,
                chattextid: "user_text",
                sendbuttonid: "send_button"
            });      
        }

        function speakIntro(what) {
            setIntroLoader('speak');

            typeitInstanceIntro.empty().type(what);
        }

        function setIntroLoader(what) {
            $('.xn-intro-view #xn-loader').removeClass('xn-loader-' + loader);
            $('.xn-intro-view #xn-loader').addClass('xn-loader-' + what);
            loader = what;
        }

        function setChatLoader(what) {
            if (loader)
                $('.xn-chat-view #xn-loader').removeClass('xn-loader-' + loader);
            $('.xn-chat-view #xn-loader').addClass('xn-loader-' + what);
            loader = what;
        }

        function reply(reply, start) {
            var parts = reply.Parts;
            if (parts.length == 0)
                return;

            typeitInstanceChat = createTypeitChatInstance();
            $('.xn-chat-elements-container').empty();
                 
            for (var i = 0; i < parts.length; i++) {
                var part = parts[i];
                var index = i;
                putInQueue(renderBotReply.bind(this, part, index));
            }

            doNextQueue();
        }

        function renderBotReply(part, index) {
            var text = part.Text;

            switch (part.Type) {
                case 0: // Text
                case 6: // Domanda
                    if (isNullOrEmpty(text)) {
                        break;
                    }

                    typeitInstanceChat
                        .empty()
                        .type(part.Text)
                        .break()
                        .pause(1500);

                    break;

                case 1: // Button
                    RenderButton(part);
                    doNextQueue();
                    break;

                case 3: // Image
                    break;

                case 9: // Video 
                    break;

                case 10: // Audio
                    break;

                case 11: // File
                    break;

                case 13:  // Button Card

                    typeitInstanceChat
                        .empty()
                        .type(part.Text)
                        .break()
                        .pause(1500);

                    putInQueue(function () {
                        for (var i = 0; i < part.Parts.length; i++) {
                            RenderButton(part.Parts[i]);
                        }
                        doNextQueue();
                    });

                    break;

                case 5:   // Carousel Card
                    break;

                case 12:  // List Card
                    break;

                case 17: // Url
                    break;

                case 19: // User text
                    break;

                case 25: // Attesa
                    break;

                default:
                    console.log("Unknow tag type:" + part.Type);
                    break;
            }
        }

        function RenderButton(part) {
            var button = document.createElement('div');

            switch (part.SubType) {
                case "element_share":
                    break;
                case "phone_number":
                    button.innerHTML = '<button class="xn-chat-button" onclick="window.open(\'tel:" + part.Command + "\', \'_blank\')\"><span>' + part.Text + '</span></button>';
                    break;
                case "web_url":
                    button.innerHTML = '<button class="xn-chat-button" onclick="window.open(\'' + part.Command + '\', \'_blank\')\"><span>' + part.Text + '</span></button>';
                    break;
                default:
                    button.innerHTML = '<button class="xn-chat-button" onclick="setChatLoader(\'think\'); Command(\'' + DropSinglePoint(part.Text) + '\', \'' + DropSinglePoint(part.Command) + '\')"><span>' + part.Text + '</span></button>';
                    break;
            }
        
            $('.xn-chat-elements-container')[0].appendChild(button.firstChild);
        }

        function DropSinglePoint(text) {
            if (!text || text == null)
                return "";

            text = text.replace(/'/g, "\\'");
            return text;
        }

    </script>
</body>

</html>